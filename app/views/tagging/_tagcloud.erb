<% if project %>
  <%
      context = project.identifier.gsub '-', '_'
      tags = {}
      Issue.tag_counts_on(context).each {|tag|
        tags[tag.name] = tag.count
      }
      WikiPage.tag_counts_on(context).each {|tag|
        tags[tag.name] = tags[tag.name].to_i + tag.count
      }

      tags = tags.reject {|key,value| value == 0 }
  %>
  <% if tags.size > 0
      min = tags.values.min
      factor = 10.0 / ((tags.values.max - min) + 1)
  %>
    <h3><%= l(:field_tags) %></h3>

    <div id='tagcloud'>
      <% tags.keys.sort.each do |tag| %>
        <%
          count = tags[tag]
          if Setting.plugin_redmine_tagging[:dynamic_font_size] == "1"
            size = 8 + ((count - min) * factor)
            style = {:style => "font-size: #{size}pt" }
          else
            style = {}
          end
          tagtitle = tag.gsub(/^#/, '')
        %>

        <% form_tag("/issues?set_filter=1", :id => "tag-#{tagtitle}") do %>
          <%= hidden_field_tag 'project_id', project.id %>
          <%= hidden_field_tag 'fields[]', 'tags' %>
          <%= hidden_field_tag 'operators[status_id]', 'o' %>
          <%= hidden_field_tag 'operators[tags]', '=' %>
          <%= hidden_field_tag 'values[tags][]', tag %>
          <%= link_to tag, 'javascript:void(0);', :onclick => "document.getElementById('tag-#{tagtitle}').submit()", :style => style %>
        <% end %>

      <% end %>
    </div>

  <% end %>
<% end %>
